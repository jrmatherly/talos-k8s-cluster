---
# ==============================================================================
# CLUSTER CONFIGURATION
# ==============================================================================
# This file defines the core settings for your Talos Kubernetes cluster.
# Fill in the REQUIRED fields and optionally customize the others.
#
# TIP: Use 'task configure' to validate and render your configuration.
# ==============================================================================

# ==============================================================================
# NETWORK CONFIGURATION
# ==============================================================================

# -- The network CIDR that contains your node IP addresses.
#    This is the subnet where your Talos nodes will be assigned IPs.
#    (REQUIRED)
#    Example: "192.168.1.0/24" for a typical home network
#    Example: "10.0.0.0/24" for a private network
node_cidr: ""

# -- DNS servers for the Talos nodes to use for external resolution.
#    These are used by the nodes themselves, not for cluster DNS.
#    Public DNS servers from this list are also used as fallback for k8s_gateway.
#    (OPTIONAL) / (DEFAULT: ["1.1.1.1", "1.0.0.1"] - Cloudflare DNS)
#    Example: ["192.168.1.1", "1.1.1.1"] - Local router + Cloudflare
#    Example: ["172.64.36.x", "172.64.36.x"] - Cloudflare for Personal Resolvers
# node_dns_servers: []

# -- NTP servers for time synchronization on Talos nodes.
#    Accurate time is critical for certificate validation and cluster operations.
#    (OPTIONAL) / (DEFAULT: ["162.159.200.1", "162.159.200.123"] - Cloudflare NTP)
# node_ntp_servers: []

# -- The default gateway (router) IP for the nodes.
#    (OPTIONAL) / (DEFAULT: First usable IP in node_cidr, e.g., .1)
#    Only set this if your gateway is NOT the first IP in your subnet.
#    Example: "192.168.1.254" if your router uses .254 instead of .1
# node_default_gateway: ""

# -- VLAN tag for Talos node network interfaces.
#    Only needed if your nodes are on a tagged VLAN and your switch ports are NOT tagged.
#    (OPTIONAL) / (REF: https://www.talos.dev/latest/advanced/advanced-networking/#vlans)
#    Example: "100" for VLAN ID 100
# node_vlan_tag: ""

# ==============================================================================
# KUBERNETES CLUSTER SETTINGS
# ==============================================================================

# -- Virtual IP address for the Kubernetes API server.
#    This IP is shared across control plane nodes for high availability.
#    (REQUIRED) - Must be an UNUSED IP within node_cidr
#    TIP: Choose an IP outside the range you'll assign to nodes.
#    Example: If nodes are .101-.106, use .100 for the API
cluster_api_addr: ""

# -- Additional hostnames/IPs to include in the API server certificate.
#    Useful if you want to access the cluster by hostname or external IP.
#    (OPTIONAL)
#    Example: ["k8s.example.com", "192.168.1.200"]
# cluster_api_tls_sans: []

# -- Pod network CIDR for internal pod-to-pod communication.
#    Must NOT overlap with node_cidr or cluster_svc_cidr.
#    (OPTIONAL) / (DEFAULT: "10.42.0.0/16" - 65,536 pod IPs)
#    WARNING: Changing this after cluster creation requires a full rebuild.
# cluster_pod_cidr: ""

# -- Service network CIDR for Kubernetes ClusterIP services.
#    Must NOT overlap with node_cidr or cluster_pod_cidr.
#    (OPTIONAL) / (DEFAULT: "10.43.0.0/16" - 65,536 service IPs)
#    WARNING: Changing this after cluster creation requires a full rebuild.
# cluster_svc_cidr: ""

# ==============================================================================
# LOAD BALANCER IPS (Cilium L2/BGP Announcements)
# ==============================================================================
# These IPs are announced by Cilium and used for LoadBalancer services.
# All must be UNUSED IPs within node_cidr.

# -- IP for k8s_gateway DNS service (internal DNS resolution).
#    Configure your router/DNS server to forward your domain queries here.
#    This enables split-DNS so internal services resolve to internal IPs.
#    (REQUIRED) - Must be an UNUSED IP within node_cidr
#    TIP: See docs/udm-split-dns.md for router configuration examples.
cluster_dns_gateway_addr: ""

# -- IP for the internal ingress gateway (envoy-internal).
#    Used for services only accessible from your local network.
#    (REQUIRED) - Must be an UNUSED IP within node_cidr
cluster_gateway_addr: ""

# -- IP for the external ingress gateway (envoy-external via Cloudflare Tunnel).
#    Used for services accessible from the public internet.
#    (REQUIRED) - Must be an UNUSED IP within node_cidr
cloudflare_gateway_addr: ""

# ==============================================================================
# GITHUB REPOSITORY SETTINGS
# ==============================================================================

# -- Your GitHub repository in "owner/repo" format.
#    This is where Flux will sync cluster state from.
#    (REQUIRED)
#    Example: "myusername/my-k8s-cluster"
repository_name: ""

# -- Git branch for Flux to monitor.
#    (OPTIONAL) / (DEFAULT: "main")
# repository_branch: ""

# -- Repository visibility setting.
#    (OPTIONAL) / (DEFAULT: "public")
#    NOTE: If "private", you must add github-deploy.key.pub to your repo's deploy keys.
#    See README for detailed instructions.
# repository_visibility: ""

# ==============================================================================
# CLOUDFLARE SETTINGS
# ==============================================================================

# -- Your Cloudflare domain(s) for the cluster.
#    Can be a single domain string or an array of domains.
#    First domain is primary (used for flux-webhook, internal infrastructure).
#    (REQUIRED)
#    Single domain example: ["example.com"]
#    Multiple domains example: ["example.com", "example.org"]
#
#    In templates, domains are available as:
#      ${SECRET_DOMAIN}   - Primary domain (first in list)
#      ${SECRET_DOMAIN_2} - Second domain
#      ${SECRET_DOMAIN_3} - Third domain, etc.
cloudflare_domains: []

# -- Cloudflare API Token with required permissions.
#    (REQUIRED) - See README "Stage 3: Cloudflare configuration" for creation steps.
#    Required permissions:
#      - Zone:DNS:Edit (from template)
#      - Account:Cloudflare Tunnel:Read (add manually)
#    TIP: Create token at: Cloudflare Portal → Manage Account → Account API Tokens
cloudflare_token: ""
# ==============================================================================
# CILIUM NETWORKING (Advanced)
# ==============================================================================

# -- Load balancer mode for Cilium.
#    DSR (Direct Server Return) is more efficient but requires compatible network.
#    SNAT works in all environments but adds latency.
#    (OPTIONAL) / (DEFAULT: "dsr")
#    Values: "dsr" or "snat"
#    REF: https://docs.cilium.io/en/stable/network/kubernetes/kubeproxy-free/
# cilium_loadbalancer_mode: ""

# -- BGP Configuration (for advanced networking setups)
#    Enable BGP peering with your router for dynamic route advertisement.
#    All three BGP settings must be configured together to enable BGP.
#    (OPTIONAL) - Only needed if your router supports BGP
#    REF: https://docs.cilium.io/en/latest/network/bgp-control-plane/

# -- BGP router IP address (your router's IP that speaks BGP)
#    Example: "192.168.1.1"
# cilium_bgp_router_addr: ""

# -- BGP ASN for your router
#    Example: "64512"
# cilium_bgp_router_asn: ""

# -- BGP ASN for Kubernetes nodes
#    Example: "64513"
# cilium_bgp_node_asn: ""

# ==============================================================================
# CONTROL PLANE SCHEDULING
# ==============================================================================

# -- Allow scheduling workloads on control plane nodes.
#    When true, removes the node-role.kubernetes.io/control-plane:NoSchedule taint
#    from control plane nodes, allowing regular workloads to run there.
#    When false, only system components with tolerations can run on control planes.
#    (OPTIONAL) / (DEFAULT: true)
#    TIP: Set to true if you have limited nodes and want to maximize resources.
#    TIP: Set to false for production clusters with dedicated worker nodes.
# allow_scheduling_on_control_planes: true

# ==============================================================================
# PROXMOX INTEGRATION (Optional)
# ==============================================================================
# Configuration for Proxmox CSI Plugin (and optionally CCM).
# Required if deploying persistent storage via Proxmox CSI.
# REF: docs/proxmox-csi-implementation.md

# -- Proxmox API URL for CSI (and CCM if using Approach B) communication.
#    (REQUIRED for Proxmox integration)
#    Example: "https://192.168.1.10:8006/api2/json"
# proxmox_api_url: ""

# -- Skip TLS certificate verification for self-signed Proxmox certs.
#    (OPTIONAL) / (DEFAULT: true)
# proxmox_insecure: true

# -- Proxmox region name (identifies the Proxmox cluster).
#    Used for topology.kubernetes.io/region label.
#    (OPTIONAL) / (DEFAULT: "talos-k8s")
# proxmox_region: ""

# -- Proxmox storage pool name for CSI volumes.
#    Must support disk images (e.g., local-lvm, local-zfs, ceph).
#    (OPTIONAL) / (DEFAULT: "local-lvm")
# proxmox_storage: ""

# -- Proxmox CSI API Token ID (from step 1.4 of implementation guide)
#    (REQUIRED for CSI) Format: "user@realm!token-name"
#    Example: "kubernetes-csi@pve!csi"
# proxmox_csi_token_id: ""

# -- Proxmox CSI API Token Secret
#    (REQUIRED for CSI) - The secret value from token creation
# proxmox_csi_token_secret: ""

# -- Proxmox CCM API Token ID (from step 1.3 of implementation guide)
#    (REQUIRED for Approach B only) Format: "user@realm!token-name"
#    Example: "kubernetes-ccm@pve!ccm"
#    NOTE: Skip if using Approach A (Static Labels)
# proxmox_ccm_token_id: ""

# -- Proxmox CCM API Token Secret
#    (REQUIRED for Approach B only) - The secret value from token creation
#    NOTE: Skip if using Approach A (Static Labels)
# proxmox_ccm_token_secret: ""

# ==============================================================================
# ENVOY AI GATEWAY (Optional)
# ==============================================================================
# Configuration for AI/LLM traffic routing via Envoy AI Gateway.
# This extends the existing Envoy Gateway with AI-specific capabilities.
# REF: https://aigateway.envoyproxy.io/docs/

# -- Enable Envoy AI Gateway integration.
#    (OPTIONAL) / (DEFAULT: false)
# envoy_ai_gateway_enabled: true

# -- Load balancer IP for the AI Gateway.
#    (REQUIRED if envoy_ai_gateway_enabled) - Must be an UNUSED IP within node_cidr
#    Example: "192.168.1.145"
# envoy_ai_gateway_addr: ""

# ==============================================================================
# MCP GATEWAY (Optional - Model Context Protocol)
# ==============================================================================
# MCP Gateway enables hosting MCP servers with SSE support.
# REF: https://modelcontextprotocol.io/specification/2025-11-25/basic/authorization

# -- Enable MCP Gateway functionality.
#    (OPTIONAL) / (DEFAULT: false)
# mcp_gateway_enabled: true

# -- MCP session timeout in seconds.
#    (OPTIONAL) / (DEFAULT: 3600 - 1 hour)
# mcp_session_timeout: 3600

# ==============================================================================
# AZURE OPENAI - US EAST REGION
# ==============================================================================
# Models: gpt-4.1, gpt-4.1-nano, gpt-4o-mini, o3, o4-mini
#         text-embedding-3-small, text-embedding-ada-002

# -- Azure OpenAI US East API Key for authentication.
#    (optional) - From Azure Portal
# azure_openai_us_east_api_key: ""

# -- Azure OpenAI US East resource name (the subdomain of your endpoint).
#    (optional)
#    Example: "my-openai" for https://my-openai.openai.azure.com
# azure_openai_us_east_resource_name: ""

# ==============================================================================
# AZURE OPENAI - US EAST2 REGION
# ==============================================================================
# Models: gpt-5, gpt-5-chat, gpt-5-mini, gpt-5-nano, gpt-5.1, gpt-5.1-chat
#         gpt-5.1-codex, gpt-5.1-codex-mini, gpt-audio, gpt-audio-mini
#         text-embedding-3-large

# -- Azure OpenAI US East2 API Key for authentication.
#    (optional) - From Azure Portal
# azure_openai_us_east2_api_key: ""

# -- Azure OpenAI US East2 resource name (the subdomain of your endpoint).
#    (optional)
#    Example: "my-ai-foundry-east2" for https://my-ai-foundry-east2.openai.azure.com
# azure_openai_us_east2_resource_name: ""

# ==============================================================================
# AZURE ENTRA ID AUTHENTICATION
# ==============================================================================
# -- Azure Entra ID Authentication (optional - alternative to API key)
#    Use these for production workloads instead of API key.
# azure_tenant_id: ""
# azure_client_id: ""
# azure_client_secret: ""

# ==============================================================================
# OBSERVABILITY STACK (Optional - Prometheus/Grafana for K8s metrics)
# ==============================================================================
# Kubernetes infrastructure metrics with Prometheus and Grafana dashboards.

# -- Enable the observability stack.
#    (OPTIONAL) / (DEFAULT: false)
# observability_enabled: true

# -- Grafana admin password.
#    (OPTIONAL) / (DEFAULT: "admin")
#    WARNING: Change this for production deployments!
# grafana_admin_password: ""

# ==============================================================================
# PROMETHEUS CONFIGURATION
# ==============================================================================

# -- Prometheus data retention period.
#    (OPTIONAL) / (DEFAULT: "7d")
# prometheus_retention: "7d"

# -- Maximum storage size before old data is removed.
#    (OPTIONAL) / (DEFAULT: "45GB")
# prometheus_retention_size: "45GB"

# -- Prometheus PVC storage size.
#    (OPTIONAL) / (DEFAULT: "50Gi")
# prometheus_storage_size: "50Gi"

# -- Storage class for Prometheus and other observability PVCs.
#    (OPTIONAL) / (DEFAULT: "proxmox-csi")
# prometheus_storage_class: "proxmox-csi"

# -- Number of Prometheus replicas.
#    (OPTIONAL) / (DEFAULT: 1)
# prometheus_replicas: 1

# ==============================================================================
# ONEDEV CONFIGURATION (Optional - Git Server with CI/CD)
# ==============================================================================
# OneDev is an All-In-One DevOps Platform with Git hosting, CI/CD, and packages.
# REF: https://docs.onedev.io/installation-guide/deploy-to-k8s
# REF: docs/onedev-implementation.md

# -- Enable OneDev deployment.
#    (OPTIONAL) / (DEFAULT: false)
# onedev_enabled: true

# -- OneDev admin password (initial setup).
#    (REQUIRED if onedev_enabled) - Will be encrypted with SOPS
#    NOTE: Change this after initial setup via the web UI
# onedev_admin_password: "your-secure-password"

# -- Storage size for OneDev data PVC.
#    (OPTIONAL) / (DEFAULT: "100Gi")
#    NOTE: Size depends on repository data - minimum 3x your total repo size
# onedev_storage_size: "100Gi"

# -- Storage class for OneDev PVC.
#    (OPTIONAL) / (DEFAULT: "proxmox-csi")
# onedev_storage_class: "proxmox-csi"

# ==============================================================================
# ONEDEV EXTERNAL DATABASE (Optional)
# ==============================================================================
# If not set, uses embedded H2 database (suitable for small deployments).
# For production with many users/projects, use external MySQL/PostgreSQL.

# -- External database type.
#    (OPTIONAL) / (DEFAULT: embedded H2)
#    Options: "mysql", "postgresql", "mariadb", "mssql"
# onedev_database_type: "mysql"

# -- External database host.
#    (REQUIRED if onedev_database_type is set)
#    Example: "mysql.database.svc" or "192.168.1.50"
# onedev_database_host: ""

# -- External database port.
#    (OPTIONAL) / (DEFAULT: "3306")
# onedev_database_port: "3306"

# -- External database name.
#    (OPTIONAL) / (DEFAULT: "onedev")
# onedev_database_name: "onedev"

# -- External database user.
#    (OPTIONAL) / (DEFAULT: "onedev")
# onedev_database_user: "onedev"

# -- External database password.
#    (REQUIRED if onedev_database_type is set)
# onedev_database_password: ""

# ==============================================================================
# ONEDEV ADVANCED CONFIGURATION
# ==============================================================================

# -- SSH service port for git operations.
#    (OPTIONAL) / (DEFAULT: 6611)
#    NOTE: If you need SSH access, configure split-DNS or expose via LoadBalancer
# onedev_ssh_port: 6611

# -- Resource limits for OneDev container.
#    (OPTIONAL) / Defaults below are suitable for small-medium deployments
# onedev_cpu_limit: "2000m"
# onedev_memory_limit: "4Gi"
# onedev_cpu_request: "500m"
# onedev_memory_request: "2Gi"

# ==============================================================================
# WORKOS AUTHKIT (Optional - OAuth 2.1 / MCP Authentication)
# ==============================================================================
# WorkOS AuthKit provides MCP 2025-11-25 compliant authorization.
# Supports CIMD, RFC 8707, Cross App Access, and enterprise SSO.
# REF: https://workos.com/docs/authkit/mcp

# -- WorkOS Client ID (from WorkOS Dashboard).
#    (REQUIRED for WorkOS integration)
# workos_client_id: "client_xxx"

# -- WorkOS Client Secret (from WorkOS Dashboard).
#    (REQUIRED for WorkOS integration) - Will be encrypted with SOPS
# workos_client_secret: "sk_live_xxx"

# -- WorkOS AuthKit subdomain (your-subdomain.authkit.app).
#    (REQUIRED for WorkOS integration)
#    Example: "mycompany" for mycompany.authkit.app
# workos_subdomain: ""
