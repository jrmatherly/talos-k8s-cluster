#| HTTPRoute for OAuth2-Proxy callback and auth endpoints #|
#% if oidc_enabled and oidc_github_enabled %#
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: oauth2-proxy
spec:
  parentRefs:
#% for gateway in oidc_target_gateways %#
    - name: #{ gateway }#
      sectionName: https
#% endfor %#
  hostnames:
    - "auth.${SECRET_DOMAIN}"
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: /
      backendRefs:
        - name: oauth2-proxy
          port: 4180
#% endif %#
