#| ============================================================ #|
#| Tier 1: Kubelet Health Probe Ingress                         #|
#| - Allows kubelet to reach pod health/readiness endpoints     #|
#| - Applies to ALL pods (empty endpointSelector)               #|
#| - Does NOT block other traffic (enableDefaultDeny: false)    #|
#| - Consolidates per-app kubelet probe ingress rules           #|
#| REF: docs/ai-context/cilium-tiered-policies.md               #|
#| ============================================================ #|
---
apiVersion: cilium.io/v2
kind: CiliumClusterwideNetworkPolicy
metadata:
  name: tier1-kubelet-probes-ingress
spec:
  description: "Allow kubelet health probes from nodes"
  endpointSelector: {}  # All pods
  enableDefaultDeny:
    ingress: false
    egress: false
  ingress:
    - fromEntities:
        - host         # Local node kubelet
        - remote-node  # Other nodes (for DaemonSets, node-local redirect)
      toPorts:
        - ports:
            # Common health/metrics ports across applications
            - port: "8080"
              protocol: TCP
            - port: "8081"
              protocol: TCP
            - port: "9090"
              protocol: TCP
            - port: "9091"
              protocol: TCP
            # Additional common ports
            - port: "3000"
              protocol: TCP
            - port: "4000"
              protocol: TCP
            - port: "8000"
              protocol: TCP
            - port: "8083"
              protocol: TCP
            - port: "8443"
              protocol: TCP
