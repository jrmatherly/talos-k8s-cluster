#% if agentgateway_addr is defined and agentgateway_observability_enabled | default(true) %#
---
# Dedicated ClusterIP service for Prometheus metrics scraping
# The Gateway-created LoadBalancer service only exposes listener ports (8080, 8443)
# This service exposes the metrics port (15020) for ServiceMonitor to scrape
apiVersion: v1
kind: Service
metadata:
  name: agentgateway-metrics
  namespace: kgateway-system
  labels:
    app.kubernetes.io/name: agentgateway-metrics
    app.kubernetes.io/component: monitoring
    app.kubernetes.io/part-of: kgateway
spec:
  type: ClusterIP
  # Select the agentgateway pods created by the Gateway resource
  selector:
    app.kubernetes.io/instance: agentgateway
    app.kubernetes.io/name: agentgateway
    gateway.networking.k8s.io/gateway-name: agentgateway
  ports:
    - name: metrics
      port: 15020
      targetPort: 15020
      protocol: TCP
#% endif %#
