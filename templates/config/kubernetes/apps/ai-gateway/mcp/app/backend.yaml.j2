#% if ai_gateway_enabled and ai_gateway_mcp_enabled and ai_gateway_mcp_servers %#
#% for server in ai_gateway_mcp_servers %#
---
# Backend for MCP server: #{ server.name }#
apiVersion: gateway.envoyproxy.io/v1alpha1
kind: Backend
metadata:
  name: mcp-#{ server.name }#
spec:
  endpoints:
    - fqdn:
        hostname: #{ server.host }#
        port: 443
---
# BackendTLSPolicy for MCP server TLS validation: #{ server.name }#
apiVersion: gateway.networking.k8s.io/v1alpha3
kind: BackendTLSPolicy
metadata:
  name: mcp-#{ server.name }#-tls
spec:
  targetRefs:
    - group: gateway.envoyproxy.io
      kind: Backend
      name: mcp-#{ server.name }#
  validation:
    wellKnownCACertificates: System
    hostname: #{ server.host }#
#% endfor %#
#% endif %#
