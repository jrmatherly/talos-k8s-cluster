#% set ai_gateway_has_backends = envoy_ai_gateway_enabled and (azure_openai_us_east_api_key or azure_openai_us_east2_api_key) %#
#% set has_agentgateway_external_mcp = agentgateway_enabled | default(false) %#
#% if ai_gateway_has_backends or has_agentgateway_external_mcp or litellm_enabled or cognee_enabled | default(false) or agentgateway_enabled | default(true) %#
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: ai-system

components:
  - ../../components/sops

resources:
  - ./namespace.yaml
#| ============================================================ #|
#| agentgateway (AI/MCP control plane) - standalone deployment  #|
#| Provides MCP OAuth proxy and AI gateway functionality        #|
#| ============================================================ #|
#% if agentgateway_enabled | default(true) %#
  - ./agentgateway-crds/ks.yaml
  - ./agentgateway/ks.yaml
#% endif %#
#| DEPRECATED: Azure OpenAI backends for Envoy AI Gateway - only include if envoy_ai_gateway_enabled #|
#% if envoy_ai_gateway_enabled and azure_openai_us_east_api_key %#
  - ./azure-openai-us-east/ks.yaml
#% endif %#
#% if envoy_ai_gateway_enabled and azure_openai_us_east2_api_key %#
  - ./azure-openai-us-east2/ks.yaml
#% endif %#
#% if has_agentgateway_external_mcp %#
  - ./mcp-servers/context7/ks.yaml
#% endif %#
#% if litellm_enabled %#
  - ./litellm/ks.yaml
#% endif %#
#% if cognee_enabled | default(false) %#
  - ./cognee/ks.yaml
#% endif %#
#% endif %#
