#% if agentgateway_addr is defined and azure_openai_eastus_api_key is defined %#
---
#| AgentgatewayBackend for Azure OpenAI (kgateway v2.2+) #|
apiVersion: gateway.kgateway.dev/v1alpha1
kind: AgentgatewayBackend
metadata:
  name: azure-openai-eastus-embeddings
  labels:
    cost-center: ai-gateway
    provider: azure-openai
    region: eastus
    model-type: embeddings
    app.kubernetes.io/name: azure-openai-eastus-embeddings
    app.kubernetes.io/component: ai-backend
    app.kubernetes.io/part-of: ai-system
spec:
  ai:
    provider:
      azureopenai:
        endpoint: "#{ azure_openai_eastus_resource_name }#.openai.azure.com"
        deploymentName: "#{ azure_openai_eastus_embeddings_deployment_name | default('text-embedding-3-small') }#"
        apiVersion: "#{ azure_openai_eastus_embeddings_api_version | default('2023-05-15') }#"
  policies:
    auth:
      secretRef:
        name: azure-openai-eastus-credentials
#% endif %#
