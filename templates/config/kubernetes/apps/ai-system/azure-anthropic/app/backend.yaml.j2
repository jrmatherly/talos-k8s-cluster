#% if agentgateway_addr is defined and azure_anthropic_api_key is defined %#
---
#| AgentgatewayBackend for Anthropic via Azure AI Foundry (kgateway v2.2+) #|
#| Uses anthropic provider with custom host for Azure AI Foundry endpoint #|
#| Azure AI Foundry Anthropic API uses x-api-key header (native Anthropic format) #|
apiVersion: agentgateway.dev/v1alpha1
kind: AgentgatewayBackend
metadata:
  name: azure-anthropic
  labels:
    cost-center: ai-gateway
    provider: azure-anthropic
    region: eastus2
    model-type: chat
    app.kubernetes.io/name: azure-anthropic
    app.kubernetes.io/component: ai-backend
    app.kubernetes.io/part-of: ai-system
spec:
  ai:
    provider:
      #| Use anthropic provider - sends auth via x-api-key header #|
      #| Model is taken from request when not specified in backend #|
      #| Available models: claude-sonnet-4-5, claude-haiku-4-5, claude-opus-4-5, claude-opus-4-1 #|
      anthropic:
        model: ""
      #| Override host/port to Azure AI Foundry endpoint #|
      host: "#{ azure_anthropic_resource_name }#.services.ai.azure.com"
      port: 443
  policies:
    auth:
      secretRef:
        name: azure-anthropic-credentials
    tls:
      sni: "#{ azure_anthropic_resource_name }#.services.ai.azure.com"
#% endif %#
