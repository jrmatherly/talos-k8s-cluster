---
# AIServiceBackend for Azure deployment: primary
apiVersion: aigateway.envoyproxy.io/v1alpha1
kind: AIServiceBackend
metadata:
  name: azure-primary
spec:
  schema:
    name: AzureOpenAI
    version: "2025-01-01-preview"
  backendRef:
    name: azure-primary
    kind: Backend
    group: gateway.envoyproxy.io
---
# Backend endpoint for Azure: primary
apiVersion: gateway.envoyproxy.io/v1alpha1
kind: Backend
metadata:
  name: azure-primary
spec:
  endpoints:
    - fqdn:
        hostname: aanopenai.openai.azure.com
        port: 443
---
# BackendTLSPolicy for TLS validation to Azure endpoint: primary
apiVersion: gateway.networking.k8s.io/v1alpha3
kind: BackendTLSPolicy
metadata:
  name: azure-primary-tls
spec:
  targetRefs:
    - group: gateway.envoyproxy.io
      kind: Backend
      name: azure-primary
  validation:
    wellKnownCACertificates: System
    hostname: aanopenai.openai.azure.com
---
# BackendSecurityPolicy for Azure API key authentication: primary
# Note: AzureAPIKey injects into 'api-key' header (Azure requirement)
#       APIKey would inject into 'Authorization' header (wrong for Azure)
apiVersion: aigateway.envoyproxy.io/v1alpha1
kind: BackendSecurityPolicy
metadata:
  name: azure-primary-auth
spec:
  targetRefs:
    - group: aigateway.envoyproxy.io
      kind: AIServiceBackend
      name: azure-primary
  type: AzureAPIKey
  azureAPIKey:
    secretRef:
      name: azure-primary-secret
      namespace: envoy-ai-gateway-system
---
# AIServiceBackend for Azure deployment: secondary
apiVersion: aigateway.envoyproxy.io/v1alpha1
kind: AIServiceBackend
metadata:
  name: azure-secondary
spec:
  schema:
    name: AzureOpenAI
    version: "2025-01-01-preview"
  backendRef:
    name: azure-secondary
    kind: Backend
    group: gateway.envoyproxy.io
---
# Backend endpoint for Azure: secondary
apiVersion: gateway.envoyproxy.io/v1alpha1
kind: Backend
metadata:
  name: azure-secondary
spec:
  endpoints:
    - fqdn:
        hostname: ets-east-us2.openai.azure.com
        port: 443
---
# BackendTLSPolicy for TLS validation to Azure endpoint: secondary
apiVersion: gateway.networking.k8s.io/v1alpha3
kind: BackendTLSPolicy
metadata:
  name: azure-secondary-tls
spec:
  targetRefs:
    - group: gateway.envoyproxy.io
      kind: Backend
      name: azure-secondary
  validation:
    wellKnownCACertificates: System
    hostname: ets-east-us2.openai.azure.com
---
# BackendSecurityPolicy for Azure API key authentication: secondary
# Note: AzureAPIKey injects into 'api-key' header (Azure requirement)
#       APIKey would inject into 'Authorization' header (wrong for Azure)
apiVersion: aigateway.envoyproxy.io/v1alpha1
kind: BackendSecurityPolicy
metadata:
  name: azure-secondary-auth
spec:
  targetRefs:
    - group: aigateway.envoyproxy.io
      kind: AIServiceBackend
      name: azure-secondary
  type: AzureAPIKey
  azureAPIKey:
    secretRef:
      name: azure-secondary-secret
      namespace: envoy-ai-gateway-system
---
# AIServiceBackend for Azure deployment: cohere
apiVersion: aigateway.envoyproxy.io/v1alpha1
kind: AIServiceBackend
metadata:
  name: azure-cohere
spec:
  schema:
    name: Cohere
    version: "v2"
  backendRef:
    name: azure-cohere
    kind: Backend
    group: gateway.envoyproxy.io
---
# Backend endpoint for Azure: cohere
apiVersion: gateway.envoyproxy.io/v1alpha1
kind: Backend
metadata:
  name: azure-cohere
spec:
  endpoints:
    - fqdn:
        hostname: aan-cohere-rerank-v3-5.eastus.models.ai.azure.com
        port: 443
---
# BackendTLSPolicy for TLS validation to Azure endpoint: cohere
apiVersion: gateway.networking.k8s.io/v1alpha3
kind: BackendTLSPolicy
metadata:
  name: azure-cohere-tls
spec:
  targetRefs:
    - group: gateway.envoyproxy.io
      kind: Backend
      name: azure-cohere
  validation:
    wellKnownCACertificates: System
    hostname: aan-cohere-rerank-v3-5.eastus.models.ai.azure.com
---
# BackendSecurityPolicy for Azure API key authentication: cohere
# Note: AzureAPIKey injects into 'api-key' header (Azure requirement)
#       APIKey would inject into 'Authorization' header (wrong for Azure)
apiVersion: aigateway.envoyproxy.io/v1alpha1
kind: BackendSecurityPolicy
metadata:
  name: azure-cohere-auth
spec:
  targetRefs:
    - group: aigateway.envoyproxy.io
      kind: AIServiceBackend
      name: azure-cohere
  # Non-Azure schemas (Cohere, Anthropic via Azure) use standard APIKey
  type: APIKey
  apiKey:
    secretRef:
      name: azure-cohere-secret
      namespace: envoy-ai-gateway-system
