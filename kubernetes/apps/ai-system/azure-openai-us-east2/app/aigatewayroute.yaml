---
# AI Gateway Route for Azure OpenAI US East2
# Routes GPT-5 series, Codex, Audio, and Embedding models with appropriate timeouts
apiVersion: aigateway.envoyproxy.io/v1alpha1
kind: AIGatewayRoute
metadata:
  name: azure-openai-us-east2-route
spec:
  parentRefs:
    - name: envoy-ai
      namespace: network
      kind: Gateway
      group: gateway.networking.k8s.io
  rules:
    # Chat models (gpt-5) - 120s timeout
    # NOTE: gpt-5 is a standard model, temperature 0-2 is supported
    - matches:
        - headers:
            - type: Exact
              name: x-ai-eg-model
              value: "gpt-5"
      backendRefs:
        - name: azure-openai-us-east2-chat
          namespace: ai-system
      timeouts:
        request: 120s
    # Reasoning model (gpt-5-nano) - 120s timeout
    # NOTE: gpt-5-nano is a reasoning model - temperature must be 1.0
    - matches:
        - headers:
            - type: Exact
              name: x-ai-eg-model
              value: "gpt-5-nano"
      backendRefs:
        - name: azure-openai-us-east2-chat
          namespace: ai-system
          bodyMutation:
            set:
              - path: "temperature"
                value: "1"
      timeouts:
        request: 120s
    # Chat models with thinking (gpt-5-chat, gpt-5.1-chat) - 300s timeout
    # NOTE: gpt-5.1-chat is a reasoning model - temperature must be 1.0
    - matches:
        - headers:
            - type: Exact
              name: x-ai-eg-model
              value: "gpt-5-chat"
        - headers:
            - type: Exact
              name: x-ai-eg-model
              value: "gpt-5.1-chat"
      backendRefs:
        - name: azure-openai-us-east2-chat-thinking
          namespace: ai-system
          bodyMutation:
            set:
              - path: "temperature"
                value: "1"
      timeouts:
        request: 300s
    # Chat models April preview (gpt-5-mini, gpt-5.1) - 120s timeout
    # NOTE: These are reasoning models - temperature must be 1.0
    - matches:
        - headers:
            - type: Exact
              name: x-ai-eg-model
              value: "gpt-5-mini"
        - headers:
            - type: Exact
              name: x-ai-eg-model
              value: "gpt-5.1"
      backendRefs:
        - name: azure-openai-us-east2-chat-apr
          namespace: ai-system
          bodyMutation:
            set:
              - path: "temperature"
                value: "1"
      timeouts:
        request: 120s
    # Codex models (gpt-5.1-codex, gpt-5.1-codex-mini) - 180s timeout
    # NOTE: These are reasoning models - temperature must be 1.0
    - matches:
        - headers:
            - type: Exact
              name: x-ai-eg-model
              value: "gpt-5.1-codex"
        - headers:
            - type: Exact
              name: x-ai-eg-model
              value: "gpt-5.1-codex-mini"
      backendRefs:
        - name: azure-openai-us-east2-codex
          namespace: ai-system
          bodyMutation:
            set:
              - path: "temperature"
                value: "1"
      timeouts:
        request: 180s
    # Audio models (gpt-audio, gpt-audio-mini) - 180s timeout
    # NOTE: Verify Envoy AI Gateway audio model support before enabling
    - matches:
        - headers:
            - type: Exact
              name: x-ai-eg-model
              value: "gpt-audio"
        - headers:
            - type: Exact
              name: x-ai-eg-model
              value: "gpt-audio-mini"
      backendRefs:
        - name: azure-openai-us-east2-audio
          namespace: ai-system
      timeouts:
        request: 180s
    # Embedding models (text-embedding-3-large) - 60s timeout
    - matches:
        - headers:
            - type: Exact
              name: x-ai-eg-model
              value: "text-embedding-3-large"
      backendRefs:
        - name: azure-openai-us-east2-embedding
          namespace: ai-system
      timeouts:
        request: 60s
