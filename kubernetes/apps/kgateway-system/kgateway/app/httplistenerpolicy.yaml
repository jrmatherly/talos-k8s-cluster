---
apiVersion: gateway.kgateway.dev/v1alpha1
kind: HTTPListenerPolicy
metadata:
  name: agentgateway-access-logs
  namespace: kgateway-system
spec:
  targetRefs:
    - group: gateway.networking.k8s.io
      kind: Gateway
      name: agentgateway
  accessLog:
    - fileSink:
        path: /dev/stdout
        jsonFormat:
          # Request metadata
          start_time: "%START_TIME%"
          method: "%REQ(:METHOD)%"
          path: "%REQ(:PATH)%"
          protocol: "%PROTOCOL%"
          # Response metadata
          response_code: "%RESPONSE_CODE%"
          response_flags: "%RESPONSE_FLAGS%"
          # Timing
          duration: "%DURATION%"
          request_duration: "%REQUEST_DURATION%"
          response_duration: "%RESPONSE_DURATION%"
          # Upstream
          upstream_host: "%UPSTREAM_HOST%"
          upstream_cluster: "%UPSTREAM_CLUSTER%"
          upstream_transport_failure_reason: "%UPSTREAM_TRANSPORT_FAILURE_REASON%"
          # Size metrics
          bytes_sent: "%BYTES_SENT%"
          bytes_received: "%BYTES_RECEIVED%"
          # Client info
          client_address: "%DOWNSTREAM_REMOTE_ADDRESS_WITHOUT_PORT%"
          # Request headers (for debugging)
          user_agent: "%REQ(USER-AGENT)%"
          x_request_id: "%REQ(X-REQUEST-ID)%"
          # AI-specific fields
          model: "%REQ(X-MODEL)%"
