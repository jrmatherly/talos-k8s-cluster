---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: proxmox-csi-plugin
spec:
  chartRef:
    kind: OCIRepository
    name: proxmox-csi-plugin
  interval: 1h
  values:
    # Use existing secret for Proxmox credentials
    existingConfigSecret: proxmox-csi-plugin
    existingConfigSecretKey: config.yaml

    # StorageClass is managed separately
    storageClass: []

    controller:
      plugin:
        image:
          repository: ghcr.io/sergelogvinov/proxmox-csi-controller
          tag: v0.16.0
      # CSI sidecar versions for Kubernetes 1.34.x
      provisioner:
        image:
          repository: registry.k8s.io/sig-storage/csi-provisioner
          tag: v6.1.0
      attacher:
        image:
          repository: registry.k8s.io/sig-storage/csi-attacher
          tag: v4.10.0
      resizer:
        image:
          repository: registry.k8s.io/sig-storage/csi-resizer
          tag: v2.0.0
      # Optional: Enable snapshotter sidecar for volume snapshots
      # snapshotter:
      #   enabled: true
      #   image:
      #     repository: registry.k8s.io/sig-storage/csi-snapshotter
      #     tag: v8.3.0

    node:
      plugin:
        image:
          repository: ghcr.io/sergelogvinov/proxmox-csi-node
          tag: v0.16.0
      driverRegistrar:
        image:
          repository: registry.k8s.io/sig-storage/csi-node-driver-registrar
          tag: v2.15.0
      # Talos uses standard kubelet directory
      kubeletDir: /var/lib/kubelet
